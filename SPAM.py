# SPAM-SMS
  <?php session_name("mbilling_client"); session_start();  if(!isset($_SESSION['client_data']['auth'])) {     echo "<script>top.location = \"index.php\";</script>";     exit;     }                  include_once "../include/functions.php"; include_once "../include/accounts.php"; include_once "../include/clients.php"; include_once "../../lib/xtpl/xtemplate.class.php";  $xtpl = new XTemplate("templates/spam.html"); $settings  = $Settings -> GetSettings(); $xtpl -> assign('COMPANY_NAME', $settings['company_name']);                                                                                                                                                                                   $xtpl -> assign('COMPANY_URL', $settings['company_url']);                                                                                                                                                                                     $xtpl -> assign('MBILLING_URL', $settings['mbilling_url']);  $xtpl -> assign('CLIENT_LOGO', $settings['client_logo']);   $Account = new TAccount(); if (!($user_data = $Account -> GetAccount($_SESSION['client_data']['account_id']))) {     echo "<script>top.location = \"index.php\";</script>";     exit;     }      $spam_sms_options = GetSelectFields($yesno, $user_data['spam_sms']); $spam_email_options = GetSelectFields($yesno, $user_data['spam_email']);  if (isset($_GET['spam_set']))     spam_set();  if (isset($_GET['spam_data_set']))     spam_data_set(); 	  $user_data['stop_date'] = time2rtime($user_data['stop_date']);  $xtpl -> assign('CUR_RATE', $settings['curr_rate']); $xtpl -> assign('SPAM_DATA', $params); $xtpl -> assign('DATA', $user_data); $xtpl -> assign('spam_sms_status', $yesno[$user_data['spam_sms']]); $xtpl -> assign('spam_email_status', $yesno[$user_data['spam_email']]); $xtpl -> assign('spam_sms_options', $spam_sms_options); $xtpl -> assign('spam_email_options', $spam_email_options); $xtpl -> parse('main'); $xtpl -> out('main');  if (!empty($ErrorString)) echo "<script> alert(\"$ErrorString\");</script>";  function spam_set()     {     global $ErrorString, $user_data, $yesno;      $new_spam_sms = $_GET['spam_sms'];     $new_spam_email = $_GET['spam_email'];      if (!in_array($new_spam_sms, array_keys($yesno)) || !in_array($new_spam_email, array_keys($yesno))) { 	$ErrorString = "А Кайзер в курсе?";         return 0;         }                              $Clients = new TClients();     $Clients -> ChangeSpamStatus($user_data, $new_spam_sms, $new_spam_email); 	     echo "<script>top.location = \"spam.php\";</script>";	     }  function spam_data_set()     {     global $ErrorString, $user_data, $params;     $params = $_GET;          if (!empty($_GET['email']) && !preg_match("%^[A-Za-z0-9](([_\.\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\.\-]?[a-zA-Z0-9]+)*)\.([A-Za-z])+$%", $_GET['email'])) { 	$ErrorString = "Ошибка! Не корректный электронный адрес"; 	return; 	}      if (!empty($_GET['mobile']) && !preg_match("/^[0-9]{10,10}+$/", $_GET['mobile'])) {         $ErrorString = "Ошибка! Не корректный номер мобильного телефона. Введите 10 значный номер"; 	return; 	}                                                               $Clients = new TClients();     $Clients -> ChangeSpamData($user_data, $_GET['email'], $_GET['mobile']); 	     echo "<script>top.location = \"spam.php\";</script>";	     } ?>
